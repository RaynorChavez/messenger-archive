{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.233.0"},"children":{"messenger-archive-storage":{"id":"messenger-archive-storage","path":"messenger-archive-storage","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.233.0"},"children":{"BackupBucket":{"id":"BackupBucket","path":"messenger-archive-storage/BackupBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"messenger-archive-storage/BackupBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"serverSideEncryptionByDefault":{"sseAlgorithm":"AES256"}}]},"bucketName":"messenger-archive-backups-952094707818","lifecycleConfiguration":{"rules":[{"expirationInDays":7,"id":"DeleteOldDailyBackups","prefix":"daily/","status":"Enabled"},{"expirationInDays":30,"id":"DeleteOldWeeklyBackups","prefix":"weekly/","status":"Enabled"},{"expirationInDays":365,"id":"DeleteOldMonthlyBackups","prefix":"monthly/","status":"Enabled"}]},"publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true}}}}}},"BackupBucketName":{"id":"BackupBucketName","path":"messenger-archive-storage/BackupBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"BackupBucketArn":{"id":"BackupBucketArn","path":"messenger-archive-storage/BackupBucketArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"messenger-archive-storage/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"Default":{"id":"Default","path":"messenger-archive-storage/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"Exports":{"id":"Exports","path":"messenger-archive-storage/Exports","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"Output{\"Fn::GetAtt\":[\"BackupBucket26B8E51C\",\"Arn\"]}":{"id":"Output{\"Fn::GetAtt\":[\"BackupBucket26B8E51C\",\"Arn\"]}","path":"messenger-archive-storage/Exports/Output{\"Fn::GetAtt\":[\"BackupBucket26B8E51C\",\"Arn\"]}","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"messenger-archive-storage/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.233.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"messenger-archive-storage/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.233.0"}}}},"messenger-archive-compute":{"id":"messenger-archive-compute","path":"messenger-archive-compute","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.233.0"},"children":{"DefaultVpc":{"id":"DefaultVpc","path":"messenger-archive-compute/DefaultVpc","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]},"children":{"PublicSubnet1":{"id":"PublicSubnet1","path":"messenger-archive-compute/DefaultVpc/PublicSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"PublicSubnet2":{"id":"PublicSubnet2","path":"messenger-archive-compute/DefaultVpc/PublicSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"PublicSubnet3":{"id":"PublicSubnet3","path":"messenger-archive-compute/DefaultVpc/PublicSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"PublicSubnet4":{"id":"PublicSubnet4","path":"messenger-archive-compute/DefaultVpc/PublicSubnet4","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"PublicSubnet5":{"id":"PublicSubnet5","path":"messenger-archive-compute/DefaultVpc/PublicSubnet5","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"PublicSubnet6":{"id":"PublicSubnet6","path":"messenger-archive-compute/DefaultVpc/PublicSubnet6","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}}}},"SecurityGroup":{"id":"SecurityGroup","path":"messenger-archive-compute/SecurityGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"messenger-archive-compute/SecurityGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"Messenger Archive - SSH, HTTP, HTTPS only","groupName":"messenger-archive-sg","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"securityGroupIngress":[{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":22,"toPort":22,"description":"SSH access"},{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":80,"toPort":80,"description":"HTTP for ACME"},{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":443,"toPort":443,"description":"HTTPS access"}],"vpcId":"vpc-0f949a7271b8ed54b"}}}}},"InstanceRole":{"id":"InstanceRole","path":"messenger-archive-compute/InstanceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[]},"children":{"ImportInstanceRole":{"id":"ImportInstanceRole","path":"messenger-archive-compute/InstanceRole/ImportInstanceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"Resource":{"id":"Resource","path":"messenger-archive-compute/InstanceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ec2.amazonaws.com"}}],"Version":"2012-10-17"},"roleName":"messenger-archive-instance-role"}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"messenger-archive-compute/InstanceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"messenger-archive-compute/InstanceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:Abort*","s3:DeleteObject*","s3:GetBucket*","s3:GetObject*","s3:List*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging"],"Effect":"Allow","Resource":[{"Fn::ImportValue":"messenger-archive-storage:ExportsOutputFnGetAttBackupBucket26B8E51CArnB9BED001"},{"Fn::Join":["",[{"Fn::ImportValue":"messenger-archive-storage:ExportsOutputFnGetAttBackupBucket26B8E51CArnB9BED001"},"/*"]]}]}],"Version":"2012-10-17"},"policyName":"InstanceRoleDefaultPolicy1531605C","roles":[{"Ref":"InstanceRole3CCE2F1D"}]}}}}}}},"Instance":{"id":"Instance","path":"messenger-archive-compute/Instance","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.Instance","version":"2.233.0","metadata":[]},"children":{"InstanceProfile":{"id":"InstanceProfile","path":"messenger-archive-compute/Instance/InstanceProfile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"roles":[{"Ref":"InstanceRole3CCE2F1D"}]}}},"Resource":{"id":"Resource","path":"messenger-archive-compute/Instance/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnInstance","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::Instance","aws:cdk:cloudformation:props":{"availabilityZone":"us-east-1a","blockDeviceMappings":[{"deviceName":"/dev/sda1","ebs":{"deleteOnTermination":true,"encrypted":true,"volumeSize":30,"volumeType":"gp3"}}],"iamInstanceProfile":{"Ref":"InstanceInstanceProfileAB5AEF02"},"imageId":"ami-0030e4319cbf4dbf2","instanceType":"t3.micro","keyName":"raynor-macbook","securityGroupIds":[{"Fn::GetAtt":["SecurityGroupDD263621","GroupId"]}],"subnetId":"subnet-091db3b0332d6139c","tags":[{"key":"Name","value":"messenger-archive"}],"userData":{"Fn::Base64":"#!/bin/bash\n#!/bin/bash\nset -e\n\n# Log everything\nexec > >(tee /var/log/user-data.log) 2>&1\n\necho '=== Updating system ==='\napt-get update\napt-get upgrade -y\n\necho '=== Installing Docker ==='\ncurl -fsSL https://get.docker.com | sh\nusermod -aG docker ubuntu\n\necho '=== Installing fail2ban ==='\napt-get install -y fail2ban\nsystemctl enable fail2ban\nsystemctl start fail2ban\n\necho '=== Setting up swap (2GB) ==='\nfallocate -l 2G /swapfile\nchmod 600 /swapfile\nmkswap /swapfile\nswapon /swapfile\necho '/swapfile none swap sw 0 0' >> /etc/fstab\necho 'vm.swappiness=10' >> /etc/sysctl.conf\nsysctl -p\n\necho '=== Hardening SSH ==='\nsed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config\nsed -i 's/PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config\nsystemctl restart sshd\n\necho '=== Creating app directory ==='\nmkdir -p /opt/messenger-archive\nchown ubuntu:ubuntu /opt/messenger-archive\n\necho '=== Installing AWS CLI ==='\napt-get install -y awscli\n\necho '=== User data complete ==='"}}}}}},"ElasticIP":{"id":"ElasticIP","path":"messenger-archive-compute/ElasticIP","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnEIP","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::EIP","aws:cdk:cloudformation:props":{"domain":"vpc"}}},"EIPAssociation":{"id":"EIPAssociation","path":"messenger-archive-compute/EIPAssociation","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnEIPAssociation","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::EIPAssociation","aws:cdk:cloudformation:props":{"eip":{"Ref":"ElasticIP"},"instanceId":{"Ref":"InstanceC1063A87"}}}},"InstanceId":{"id":"InstanceId","path":"messenger-archive-compute/InstanceId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"PublicIP":{"id":"PublicIP","path":"messenger-archive-compute/PublicIP","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"SSHCommand":{"id":"SSHCommand","path":"messenger-archive-compute/SSHCommand","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"messenger-archive-compute/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"Default":{"id":"Default","path":"messenger-archive-compute/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"messenger-archive-compute/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.233.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"messenger-archive-compute/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.233.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"}}}}}